<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Game - Brain Training</title>
  <style>
    /* ===== Reset & Base ===== */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #1E1E24;
      --bg-secondary: #26262E;
      --bg-card: #2E2E36;
      --accent: #4A9B8C;
      --accent-light: #5BB8A6;
      --accent-glow: rgba(74, 155, 140, 0.3);
      --success: #D4A853;
      --success-glow: rgba(212, 168, 83, 0.25);
      --warning: #E67E22;
      --steel-blue: #40739E;
      --text-primary: #F5F5F5;
      --text-secondary: #A0A0A8;
      --text-muted: #6B6B73;
      --radius: 12px;
      --transition: 0.3s ease;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
    }

    /* ===== Header ===== */
    .header {
      text-align: center;
      padding: 2rem 1rem 1rem;
      width: 100%;
      max-width: 800px;
    }

    .header h1 {
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--warning), var(--accent), var(--success));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.25rem;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* ===== Controls Bar ===== */
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      padding: 0.75rem 1rem;
      width: 100%;
      max-width: 800px;
    }

    .difficulty-btn {
      padding: 0.5rem 1.25rem;
      border: 2px solid var(--bg-card);
      border-radius: 2rem;
      background: transparent;
      color: var(--text-secondary);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .difficulty-btn:hover {
      border-color: var(--accent);
      color: var(--text-primary);
    }

    .difficulty-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--text-primary);
      box-shadow: 0 0 20px var(--accent-glow);
    }

    /* ===== Stats Bar ===== */
    .stats {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      padding: 0.75rem 1rem;
      width: 100%;
      max-width: 800px;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    .stat-icon {
      font-size: 1.1rem;
    }

    .stat-value {
      font-weight: 700;
      color: var(--text-primary);
      min-width: 2ch;
    }

    .stars {
      display: flex;
      gap: 0.15rem;
    }

    .star {
      font-size: 1.1rem;
      transition: var(--transition);
    }

    .star.filled {
      color: var(--warning);
    }

    .star.empty {
      color: var(--text-muted);
    }

    /* ===== Game Board ===== */
    .board-container {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
      width: 100%;
      flex: 1;
    }

    .board {
      display: grid;
      gap: 10px;
      perspective: 1000px;
      max-width: 700px;
      width: 100%;
    }

    .board.cols-4 { grid-template-columns: repeat(4, 1fr); }
    .board.cols-6 { grid-template-columns: repeat(6, 1fr); }

    /* ===== Card ===== */
    .card {
      aspect-ratio: 1;
      position: relative;
      cursor: pointer;
      transform-style: preserve-3d;
      transition: transform 0.5s ease;
      border-radius: var(--radius);
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card.matched {
      transform: rotateY(180deg);
      cursor: default;
    }

    .card.matched .card-front {
      border-color: var(--success);
      box-shadow: 0 0 20px var(--success-glow), inset 0 0 20px var(--success-glow);
    }

    .card-face {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius);
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
    }

    .card-back {
      background: var(--bg-card);
      border: 2px solid rgba(64, 115, 158, 0.3);
      transition: border-color var(--transition), box-shadow var(--transition);
    }

    .card-back::after {
      content: '?';
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
      opacity: 0.4;
    }

    .card:not(.flipped):not(.matched):hover .card-back {
      border-color: var(--accent);
      box-shadow: 0 0 15px var(--accent-glow);
    }

    .card-front {
      background: var(--bg-secondary);
      border: 2px solid var(--accent);
      transform: rotateY(180deg);
      font-size: 2.5rem;
      user-select: none;
    }

    /* ===== Shake animation for mismatch ===== */
    @keyframes shake {
      0%, 100% { transform: rotateY(180deg) translateX(0); }
      25% { transform: rotateY(180deg) translateX(-6px); }
      75% { transform: rotateY(180deg) translateX(6px); }
    }

    .card.shake {
      animation: shake 0.4s ease;
    }

    /* ===== Pop animation for match ===== */
    @keyframes pop {
      0% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.1); }
      100% { transform: rotateY(180deg) scale(1); }
    }

    .card.pop {
      animation: pop 0.4s ease;
    }

    /* ===== Restart Button ===== */
    .restart-btn {
      padding: 0.6rem 1.5rem;
      border: 2px solid var(--accent);
      border-radius: 2rem;
      background: transparent;
      color: var(--accent-light);
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .restart-btn:hover {
      background: var(--accent);
      color: var(--text-primary);
      box-shadow: 0 0 20px var(--accent-glow);
    }

    /* ===== Win Modal ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 14, 23, 0.85);
      backdrop-filter: blur(4px);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 2px solid var(--accent);
      border-radius: 1.25rem;
      padding: 2.5rem 2rem;
      text-align: center;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 60px var(--accent-glow);
      animation: modal-in 0.4s ease;
    }

    @keyframes modal-in {
      from { opacity: 0; transform: scale(0.9) translateY(20px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    .modal h2 {
      font-size: 1.75rem;
      margin-bottom: 0.25rem;
      background: linear-gradient(135deg, var(--success), var(--warning));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal .subtitle {
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }

    .modal-stats {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 1.5rem;
    }

    .modal-stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .modal-stat .label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .modal-stat .value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-stars {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }

    .best-score-msg {
      color: var(--warning);
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      display: none;
    }

    .best-score-msg.show {
      display: block;
    }

    .modal-btn {
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 2rem;
      background: var(--accent);
      color: var(--text-primary);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-btn:hover {
      background: var(--accent-light);
      box-shadow: 0 0 25px var(--accent-glow);
    }

    /* ===== Footer / Best Score ===== */
    .footer {
      text-align: center;
      padding: 1rem;
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .best-score {
      color: var(--text-secondary);
      font-size: 0.85rem;
      margin-bottom: 0.25rem;
    }

    .best-score span {
      color: var(--warning);
      font-weight: 700;
    }

    /* ===== Responsive ===== */
    @media (max-width: 600px) {
      .header h1 { font-size: 1.5rem; }
      .board { gap: 7px; }
      .card-front { font-size: 1.8rem; }
      .card-back::after { font-size: 1.3rem; }
      .stats { gap: 1rem; }
      .stat { font-size: 0.85rem; }
      .modal-stats { gap: 1rem; }
    }

    @media (max-width: 420px) {
      .board { gap: 5px; }
      .card-front { font-size: 1.4rem; }
      .controls { gap: 0.5rem; }
      .difficulty-btn { padding: 0.4rem 0.9rem; font-size: 0.8rem; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <h1>Memory Game</h1>
    <p>Train your brain &mdash; find all the matching pairs</p>
  </div>

  <!-- Difficulty Selection -->
  <div class="controls">
    <button class="difficulty-btn active" data-level="easy">Easy (4&times;3)</button>
    <button class="difficulty-btn" data-level="medium">Medium (4&times;4)</button>
    <button class="difficulty-btn" data-level="hard">Hard (6&times;4)</button>
    <button class="restart-btn" id="restartBtn" title="Restart game">Restart</button>
  </div>

  <!-- Stats -->
  <div class="stats">
    <div class="stat">
      <span class="stat-icon">&#9201;</span>
      <span class="stat-value" id="timer">0:00</span>
    </div>
    <div class="stat">
      <span class="stat-icon">&#9878;</span>
      <span>Moves:</span>
      <span class="stat-value" id="moves">0</span>
    </div>
    <div class="stat">
      <div class="stars" id="stars">
        <span class="star filled">&#9733;</span>
        <span class="star filled">&#9733;</span>
        <span class="star filled">&#9733;</span>
      </div>
    </div>
  </div>

  <!-- Game Board -->
  <div class="board-container">
    <div class="board" id="board"></div>
  </div>

  <!-- Best Score -->
  <div class="footer">
    <div class="best-score" id="bestScore"></div>
    <div>Match pairs to exercise your memory</div>
  </div>

  <!-- Win Modal -->
  <div class="modal-overlay" id="modal">
    <div class="modal">
      <h2>Well Done!</h2>
      <p class="subtitle">You found all the pairs</p>
      <div class="modal-stars" id="modalStars"></div>
      <div class="modal-stats">
        <div class="modal-stat">
          <span class="label">Time</span>
          <span class="value" id="modalTime">0:00</span>
        </div>
        <div class="modal-stat">
          <span class="label">Moves</span>
          <span class="value" id="modalMoves">0</span>
        </div>
      </div>
      <div class="best-score-msg" id="bestMsg">New Best Score!</div>
      <button class="modal-btn" id="playAgainBtn">Play Again</button>
    </div>
  </div>

  <script>
    /* ===== Symbol Pool ===== */
    const SYMBOLS = [
      'ðŸ¶','ðŸ±','ðŸ­','ðŸ¹','ðŸ°','ðŸ¦Š','ðŸ»','ðŸ¼',
      'ðŸ¨','ðŸ¯','ðŸ¦','ðŸ¸','ðŸµ','ðŸ”','ðŸ§','ðŸ¦',
      'ðŸ¦„','ðŸ','ðŸ™','ðŸ¦‹','ðŸŒ¸','ðŸŒ»','ðŸ„','ðŸ€'
    ];

    /* ===== Difficulty Config ===== */
    const LEVELS = {
      easy:   { cols: 4, rows: 3, pairs: 6  },
      medium: { cols: 4, rows: 4, pairs: 8  },
      hard:   { cols: 6, rows: 4, pairs: 12 }
    };

    /* ===== State ===== */
    let currentLevel = 'easy';
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let totalPairs = 0;
    let moves = 0;
    let timerInterval = null;
    let seconds = 0;
    let gameStarted = false;
    let lockBoard = false;

    /* ===== DOM References ===== */
    const boardEl = document.getElementById('board');
    const movesEl = document.getElementById('moves');
    const timerEl = document.getElementById('timer');
    const starsEl = document.getElementById('stars');
    const bestScoreEl = document.getElementById('bestScore');
    const modalEl = document.getElementById('modal');
    const modalTimeEl = document.getElementById('modalTime');
    const modalMovesEl = document.getElementById('modalMoves');
    const modalStarsEl = document.getElementById('modalStars');
    const bestMsgEl = document.getElementById('bestMsg');
    const restartBtn = document.getElementById('restartBtn');
    const playAgainBtn = document.getElementById('playAgainBtn');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');

    /* ===== Utility ===== */
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return `${m}:${sec.toString().padStart(2, '0')}`;
    }

    function getStarCount() {
      const level = LEVELS[currentLevel];
      const optimal = level.pairs;      // perfect game = pairs moves
      const ratio = moves / optimal;
      if (ratio <= 1.5) return 3;
      if (ratio <= 2.5) return 2;
      return 1;
    }

    function renderStars(container, count) {
      container.innerHTML = '';
      for (let i = 0; i < 3; i++) {
        const span = document.createElement('span');
        span.className = 'star ' + (i < count ? 'filled' : 'empty');
        span.innerHTML = '&#9733;';
        container.appendChild(span);
      }
    }

    /* ===== Best Score (localStorage) ===== */
    function getBestScore() {
      try {
        const data = localStorage.getItem('memoryGame_best_' + currentLevel);
        return data ? JSON.parse(data) : null;
      } catch { return null; }
    }

    function saveBestScore(moves, time, stars) {
      try {
        const prev = getBestScore();
        // Better score = more stars, then fewer moves, then less time
        if (!prev || stars > prev.stars || (stars === prev.stars && moves < prev.moves)) {
          localStorage.setItem('memoryGame_best_' + currentLevel, JSON.stringify({ moves, time, stars }));
          return true;
        }
      } catch {}
      return false;
    }

    function showBestScore() {
      const best = getBestScore();
      if (best) {
        bestScoreEl.innerHTML = `Best (${currentLevel}): <span>${best.moves} moves</span> &middot; ${formatTime(best.time)} &middot; ${'&#9733;'.repeat(best.stars)}`;
      } else {
        bestScoreEl.textContent = '';
      }
    }

    /* ===== Timer ===== */
    function startTimer() {
      if (timerInterval) return;
      timerInterval = setInterval(() => {
        seconds++;
        timerEl.textContent = formatTime(seconds);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function resetTimer() {
      stopTimer();
      seconds = 0;
      timerEl.textContent = '0:00';
    }

    /* ===== Card Creation ===== */
    function createCard(symbol, index) {
      const card = document.createElement('div');
      card.className = 'card';
      card.dataset.symbol = symbol;
      card.dataset.index = index;

      card.innerHTML = `
        <div class="card-face card-back"></div>
        <div class="card-face card-front">${symbol}</div>
      `;

      card.addEventListener('click', () => handleCardClick(card));
      return card;
    }

    /* ===== Game Logic ===== */
    function handleCardClick(card) {
      if (lockBoard) return;
      if (card.classList.contains('flipped') || card.classList.contains('matched')) return;

      // Start timer on first click
      if (!gameStarted) {
        gameStarted = true;
        startTimer();
      }

      card.classList.add('flipped');
      flippedCards.push(card);

      if (flippedCards.length === 2) {
        moves++;
        movesEl.textContent = moves;
        renderStars(starsEl, getStarCount());
        checkForMatch();
      }
    }

    function checkForMatch() {
      const [a, b] = flippedCards;
      const isMatch = a.dataset.symbol === b.dataset.symbol;

      if (isMatch) {
        handleMatch(a, b);
      } else {
        handleMismatch(a, b);
      }
    }

    function handleMatch(a, b) {
      a.classList.add('matched', 'pop');
      b.classList.add('matched', 'pop');
      flippedCards = [];
      matchedPairs++;

      if (matchedPairs === totalPairs) {
        stopTimer();
        setTimeout(showWinModal, 600);
      }
    }

    function handleMismatch(a, b) {
      lockBoard = true;
      setTimeout(() => {
        a.classList.add('shake');
        b.classList.add('shake');
      }, 400);

      setTimeout(() => {
        a.classList.remove('flipped', 'shake');
        b.classList.remove('flipped', 'shake');
        flippedCards = [];
        lockBoard = false;
      }, 1000);
    }

    /* ===== Win Modal ===== */
    function showWinModal() {
      const starCount = getStarCount();
      const isNewBest = saveBestScore(moves, seconds, starCount);

      modalTimeEl.textContent = formatTime(seconds);
      modalMovesEl.textContent = moves;
      renderStars(modalStarsEl, starCount);

      bestMsgEl.classList.toggle('show', isNewBest);
      modalEl.classList.add('show');
      showBestScore();
    }

    function hideModal() {
      modalEl.classList.remove('show');
    }

    /* ===== Init Game ===== */
    function initGame() {
      hideModal();
      resetTimer();
      gameStarted = false;
      lockBoard = false;
      moves = 0;
      matchedPairs = 0;
      flippedCards = [];
      movesEl.textContent = '0';
      renderStars(starsEl, 3);

      const level = LEVELS[currentLevel];
      totalPairs = level.pairs;

      // Pick random symbols and duplicate for pairs
      const chosen = shuffle([...SYMBOLS]).slice(0, totalPairs);
      cards = shuffle([...chosen, ...chosen]);

      // Set grid
      boardEl.className = 'board cols-' + level.cols;
      boardEl.innerHTML = '';

      cards.forEach((symbol, i) => {
        boardEl.appendChild(createCard(symbol, i));
      });

      showBestScore();
    }

    /* ===== Event Listeners ===== */
    difficultyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        difficultyBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLevel = btn.dataset.level;
        initGame();
      });
    });

    restartBtn.addEventListener('click', initGame);
    playAgainBtn.addEventListener('click', initGame);

    modalEl.addEventListener('click', (e) => {
      if (e.target === modalEl) hideModal();
    });

    /* ===== Start ===== */
    initGame();
  </script>

</body>
</html>
